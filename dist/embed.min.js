/*! flat-embed v1.5.1 | (c) 2023 Tutteo Ltd. (Flat) | Apache-2.0 License | https://github.com/FlatIO/embed-client */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).Flat=e.Flat||{},e.Flat.Embed=t())}(this,function(){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(r.key),r)}}function e(e,t,n){t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1})}if(void 0===window.postMessage)throw new Error("The Flat Embed JS API is not supported in this browser");function t(e,t){r=t.baseUrl||"https://flat-embed.com",r+="/"+(t.score||"blank"),n=Object.assign({jsapi:!0},t.embedParams);var n,r=r+"?"+Object.keys(n).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(n[e]))}).join("&"),o=document.createElement("iframe");return o.setAttribute("src",r),o.setAttribute("width",t.width||"100%"),o.setAttribute("height",t.height||"100%"),o.setAttribute("allowfullscreen",!0),o.setAttribute("allow","autoplay; midi"),o.setAttribute("frameborder","0"),e.appendChild(o),o}function a(e,t,n){if(!e.element.contentWindow||!e.element.contentWindow.postMessage)throw new Error("No `contentWindow` or `contentWindow.postMessage` available on the element");e.element.contentWindow.postMessage({method:t,parameters:n},e.origin)}var u=function(){function t(e){return i(this,t),this.embed=e,this.promises={},this.eventCallbacks={},this}return e(t,[{key:"pushCall",value:function(e,t,n){this.promises[e]=this.promises[e]||[],this.promises[e].push({resolve:t,reject:n})}},{key:"subscribeEvent",value:function(e,t){return this.eventCallbacks[e]=this.eventCallbacks[e]||[],this.eventCallbacks[e].push(t),1===this.eventCallbacks[e].length}},{key:"unsubscribeEvent",value:function(e,t){var n;return!!this.eventCallbacks[e]&&(t?0<=(n=this.eventCallbacks[e].indexOf(t))&&this.eventCallbacks[e].splice(n,1):this.eventCallbacks[e]=[],!t||0===this.eventCallbacks[e].length)}},{key:"process",value:function(e){e.method?this.processMethodResponse(e):e.event&&this.processEvent(e)}},{key:"processMethodResponse",value:function(e){var t;this.promises[e.method]&&(t=this.promises[e.method].shift())&&(e.error?t.reject(e.error):t.resolve(e.response))}},{key:"processEvent",value:function(t){var n=this;this.eventCallbacks[t.event]&&0!==this.eventCallbacks[t.event].length&&this.eventCallbacks[t.event].forEach(function(e){e.call(n.embed,t.parameters)})}}]),t}(),l=new WeakMap,s=new WeakMap;return function(){function Embed(n){var r=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(i(this,Embed),n=function(e){var t;if((e="string"==typeof(e=window.jQuery&&e instanceof window.jQuery?e[0]:e)?document.getElementById(e):e)instanceof window.HTMLElement)return e="IFRAME"!==e.nodeName&&(t=e.querySelector("iframe"))?t:e;throw new TypeError("The first parameter must be an existing DOM element or an identifier.")}(n),l.has(n))return l.get(n);"IFRAME"!==n.nodeName&&(n=t(n,e)),this.origin="*",this.element=n,this.embedCallback=new u;e=new Promise(function(t){window.addEventListener("message",function(e){n.contentWindow===e.source&&("*"===r.origin&&(r.origin=e.origin),"ready"===(e=e="string"==typeof(e=e.data)?JSON.parse(e):e).event||"ping"===e.method?t():r.embedCallback.process(e))},!1),a(r,"ping")});return l.set(this.element,this),s.set(this.element,e),this}return e(Embed,[{key:"ready",value:function(){return s.get(this.element)}},{key:"call",value:function(n){var r=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(e,t){return r.ready().then(function(){r.embedCallback.pushCall(n,e,t),a(r,n,o)})})}},{key:"on",value:function(e,t){if("string"!=typeof e)throw new TypeError("An event name (string) is required");if("function"!=typeof t)throw new TypeError("An callback (function) is required");this.embedCallback.subscribeEvent(e,t)&&this.call("addEventListener",e).catch(function(){})}},{key:"off",value:function(e,t){if("string"!=typeof e)throw new TypeError("An event name (string) is required");this.embedCallback.unsubscribeEvent(e,t)&&this.call("removeEventListener",e).catch(function(){})}},{key:"loadFlatScore",value:function(e){return this.call("loadFlatScore",e="string"==typeof e?{score:e}:e)}},{key:"loadMusicXML",value:function(e){return this.call("loadMusicXML",e)}},{key:"loadJSON",value:function(e){return this.call("loadJSON",e)}},{key:"getJSON",value:function(){return this.call("getJSON")}},{key:"getMusicXML",value:function(n){var r=this;return new Promise(function(t,e){if("object"!==o(n=n||{}))return e(new TypeError("Options must be an object"));r.call("getMusicXML",n).then(function(e){return t("string"==typeof e?e:new Uint8Array(e))}).catch(e)})}},{key:"getPNG",value:function(n){var r=this;return new Promise(function(t,e){if("object"!==o(n=n||{}))return e(new TypeError("Options must be an object"));r.call("getPNG",n).then(function(e){return t("string"==typeof e?e:new Uint8Array(e))}).catch(e)})}},{key:"getMIDI",value:function(){return this.call("getMIDI").then(function(e){return new Uint8Array(e)})}},{key:"getFlatScoreMetadata",value:function(){return this.call("getFlatScoreMetadata")}},{key:"getEmbedConfig",value:function(){return this.call("getEmbedConfig")}},{key:"setEditorConfig",value:function(e){return this.call("setEditorConfig",e)}},{key:"fullscreen",value:function(e){return this.call("fullscreen",e)}},{key:"play",value:function(){return this.call("play")}},{key:"pause",value:function(){return this.call("pause")}},{key:"stop",value:function(){return this.call("stop")}},{key:"mute",value:function(){return this.call("mute")}},{key:"getMasterVolume",value:function(){return this.call("getMasterVolume")}},{key:"setMasterVolume",value:function(e){return this.call("getMasterVolume",e)}},{key:"getPartVolume",value:function(e){return this.call("getPartVolume",e)}},{key:"setPartVolume",value:function(e){return this.call("setPartVolume",e)}},{key:"mutePart",value:function(e){return this.call("mutePart",e)}},{key:"unmutePart",value:function(e){return this.call("unmutePart",e)}},{key:"setPartSoloMode",value:function(e){return this.call("setPartSoloMode",e)}},{key:"unsetPartSoloMode",value:function(e){return this.call("unsetPartSoloMode",e)}},{key:"getPartSoloMode",value:function(e){return this.call("getPartSoloMode",e)}},{key:"getPartReverb",value:function(e){return this.call("getPartReverb",e)}},{key:"setPartReverb",value:function(e){return this.call("setPartReverb",e)}},{key:"setTrack",value:function(e){return this.call("setTrack",e)}},{key:"useTrack",value:function(e){return this.call("useTrack",e)}},{key:"seekTrackTo",value:function(e){return this.call("seekTrackTo",e)}},{key:"print",value:function(){return this.call("print")}},{key:"getZoom",value:function(){return this.call("getZoom")}},{key:"setZoom",value:function(e){return this.call("setZoom",e)}},{key:"getAutoZoom",value:function(){return this.call("getAutoZoom")}},{key:"setAutoZoom",value:function(e){return this.call("setAutoZoom",e)}},{key:"focusScore",value:function(){return this.call("focusScore")}},{key:"getCursorPosition",value:function(){return this.call("getCursorPosition")}},{key:"setCursorPosition",value:function(e){return this.call("setCursorPosition",e)}},{key:"getParts",value:function(){return this.call("getParts")}},{key:"getDisplayedParts",value:function(){return this.call("getDisplayedParts")}},{key:"setDisplayedParts",value:function(e){return this.call("setDisplayedParts",e)}},{key:"getNbMeasures",value:function(){return this.call("getNbMeasures")}},{key:"getMeasuresUuids",value:function(){return this.call("getMeasuresUuids")}},{key:"getMeasureDetails",value:function(){return this.call("getMeasureDetails")}},{key:"getNoteDetails",value:function(){return this.call("getNoteDetails")}},{key:"goLeft",value:function(){return this.call("goLeft",{mute:0<arguments.length&&void 0!==arguments[0]&&arguments[0]})}},{key:"goRight",value:function(){return this.call("goRight",{mute:0<arguments.length&&void 0!==arguments[0]&&arguments[0]})}},{key:"getMetronomeMode",value:function(){return this.call("getMetronomeMode")}},{key:"setMetronomeMode",value:function(e){return this.call("setMetronomeMode",{mode:e})}},{key:"getPlaybackSpeed",value:function(){return this.call("getPlaybackSpeed")}},{key:"setPlaybackSpeed",value:function(e){return this.call("setPlaybackSpeed",{speed:e})}},{key:"scrollToCursor",value:function(){return this.call("scrollToCursor")}}]),Embed}()});