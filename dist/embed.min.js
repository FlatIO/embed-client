/*! flat-embed v0.1.0 | (c) 2017 Tutteo Ltd. (Flat) | Apache-2.0 License | https://github.com/FlatIO/embed-client */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.Flat=t.Flat||{},t.Flat.Embed=e())}(this,function(){"use strict";function t(t){return t&&t.__esModule?t.default:t}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t){if(window.jQuery&&t instanceof window.jQuery&&(t=t[0]),"string"==typeof t&&(t=document.getElementById(t)),!(t instanceof window.HTMLElement))throw new TypeError("The first parameter must be an existing DOM element or an identifier.");if("IFRAME"!==t.nodeName){var e=t.querySelector("iframe");e&&(t=e)}return t}function r(t){var e=t.baseUrl||"https://flat.io/embed";e+="/"+(t.score||"blank");var n=jn({jsapi:!0},t.embedParams);return e+"?"+_n(n).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])}).join("&")}function o(t,e){var n=r(e),o=document.createElement("iframe");return o.setAttribute("src",n),o.setAttribute("width",e.width||"100%"),o.setAttribute("height",e.height||"100%"),o.setAttribute("allowfullscreen",!0),o.setAttribute("frameborder","0"),t.appendChild(o),o}function i(t,e,n){if(!t.element.contentWindow||!t.element.contentWindow.postMessage)throw new Error("No `contentWindow` or `contentWindow.postMessage` avaialble on the element");var r={method:e,parameters:n};t.element.contentWindow.postMessage(r,t.origin)}function u(t){return"string"==typeof t&&(t=JSON.parse(t)),t}var c=Math.ceil,s=Math.floor,a=function(t){return isNaN(t=+t)?0:(t>0?s:c)(t)},f=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},l=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),h=e(function(t){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)}),v=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},p=function(t,e,n){if(v(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},d=function(t){return"object"==typeof t?null!==t:"function"==typeof t},y=function(t){if(!d(t))throw TypeError(t+" is not an object!");return t},m=function(t){try{return!!t()}catch(t){return!0}},b=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),g=l.document,_=d(g)&&d(g.createElement),w=function(t){return _?g.createElement(t):{}},k=!b&&!m(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),j=function(t,e){if(!d(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!d(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!d(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!d(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},E=Object.defineProperty,O=b?Object.defineProperty:function(t,e,n){if(y(t),e=j(e,!0),y(n),k)try{return E(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t},M={f:O},S=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},P=b?function(t,e,n){return M.f(t,e,S(1,n))}:function(t,e,n){return t[e]=n,t},C=function(t,e,n){var r,o,i,u=t&C.F,c=t&C.G,s=t&C.S,a=t&C.P,f=t&C.B,v=t&C.W,d=c?h:h[e]||(h[e]={}),y=d.prototype,m=c?l:s?l[e]:(l[e]||{}).prototype;c&&(n=e);for(r in n)(o=!u&&m&&void 0!==m[r])&&r in d||(i=o?m[r]:n[r],d[r]=c&&"function"!=typeof m[r]?n[r]:f&&o?p(i,l):v&&m[r]==i?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):a&&"function"==typeof i?p(Function.call,i):i,a&&((d.virtual||(d.virtual={}))[r]=i,t&C.R&&y&&!y[r]&&P(y,r,i)))};C.F=1,C.G=2,C.S=4,C.P=8,C.B=16,C.W=32,C.U=64,C.R=128;var x=C,A=P,F={}.hasOwnProperty,T=function(t,e){return F.call(t,e)},I={},R={}.toString,W=function(t){return R.call(t).slice(8,-1)},N=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==W(t)?t.split(""):Object(t)},L=function(t){return N(f(t))},D=Math.min,U=function(t){return t>0?D(a(t),9007199254740991):0},z=Math.max,q=Math.min,B=function(t,e){return t=a(t),t<0?z(t+e,0):q(t,e)},J=l["__core-js_shared__"]||(l["__core-js_shared__"]={}),G=function(t){return J[t]||(J[t]={})},K=0,Z=Math.random(),H=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++K+Z).toString(36))},Q=G("keys"),Y=function(t){return Q[t]||(Q[t]=H(t))},V=function(t){return function(e,n,r){var o,i=L(e),u=U(i.length),c=B(r,u);if(t&&n!=n){for(;u>c;)if((o=i[c++])!=o)return!0}else for(;u>c;c++)if((t||c in i)&&i[c]===n)return t||c||0;return!t&&-1}}(!1),X=Y("IE_PROTO"),$=function(t,e){var n,r=L(t),o=0,i=[];for(n in r)n!=X&&T(r,n)&&i.push(n);for(;e.length>o;)T(r,n=e[o++])&&(~V(i,n)||i.push(n));return i},tt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),et=Object.keys||function(t){return $(t,tt)},nt=b?Object.defineProperties:function(t,e){y(t);for(var n,r=et(e),o=r.length,i=0;o>i;)M.f(t,n=r[i++],e[n]);return t},rt=l.document&&document.documentElement,ot=Y("IE_PROTO"),it=function(){},ut=function(){var t,e=w("iframe"),n=tt.length;for(e.style.display="none",rt.appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),ut=t.F;n--;)delete ut.prototype[tt[n]];return ut()},ct=Object.create||function(t,e){var n;return null!==t?(it.prototype=y(t),n=new it,it.prototype=null,n[ot]=t):n=ut(),void 0===e?n:nt(n,e)},st=e(function(t){var e=G("wks"),n=l.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:H)("Symbol."+t))}).store=e}),at=M.f,ft=st("toStringTag"),lt=function(t,e,n){t&&!T(t=n?t:t.prototype,ft)&&at(t,ft,{configurable:!0,value:e})},ht={};P(ht,st("iterator"),function(){return this});var vt=function(t,e,n){t.prototype=ct(ht,{next:S(1,n)}),lt(t,e+" Iterator")},pt=function(t){return Object(f(t))},dt=Y("IE_PROTO"),yt=Object.prototype,mt=Object.getPrototypeOf||function(t){return t=pt(t),T(t,dt)?t[dt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?yt:null},bt=st("iterator"),gt=!([].keys&&"next"in[].keys()),_t=function(){return this},wt=function(t,e,n,r,o,i,u){vt(n,e,r);var c,s,a,f=function(t){if(!gt&&t in p)return p[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},l=e+" Iterator",h="values"==o,v=!1,p=t.prototype,d=p[bt]||p["@@iterator"]||o&&p[o],y=d||f(o),m=o?h?f("entries"):y:void 0,b="Array"==e?p.entries||d:d;if(b&&(a=mt(b.call(new t)))!==Object.prototype&&lt(a,l,!0),h&&d&&"values"!==d.name&&(v=!0,y=function(){return d.call(this)}),u&&(gt||v||!p[bt])&&P(p,bt,y),I[e]=y,I[l]=_t,o)if(c={values:h?y:f("values"),keys:i?y:f("keys"),entries:m},u)for(s in c)s in p||A(p,s,c[s]);else x(x.P+x.F*(gt||v),e,c);return c},kt=function(t){return function(e,n){var r,o,i=String(f(e)),u=a(n),c=i.length;return u<0||u>=c?t?"":void 0:(r=i.charCodeAt(u),r<55296||r>56319||u+1===c||(o=i.charCodeAt(u+1))<56320||o>57343?t?i.charAt(u):r:t?i.slice(u,u+2):o-56320+(r-55296<<10)+65536)}}(!0);wt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=kt(e,n),this._i+=t.length,{value:t,done:!1})});var jt=function(t,e){return{value:e,done:!!t}};wt(Array,"Array",function(t,e){this._t=L(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,jt(1)):"keys"==e?jt(0,n):"values"==e?jt(0,t[n]):jt(0,[n,t[n]])},"values");I.Arguments=I.Array;for(var Et=st("toStringTag"),Ot=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],Mt=0;Mt<5;Mt++){var St=Ot[Mt],Pt=l[St],Ct=Pt&&Pt.prototype;Ct&&!Ct[Et]&&P(Ct,Et,St),I[St]=I.Array}var xt,At,Ft,Tt=st("toStringTag"),It="Arguments"==W(function(){return arguments}()),Rt=function(t,e){try{return t[e]}catch(t){}},Wt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=Rt(e=Object(t),Tt))?n:It?W(e):"Object"==(r=W(e))&&"function"==typeof e.callee?"Arguments":r},Nt=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},Lt=function(t,e,n,r){try{return r?e(y(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&y(o.call(t)),e}},Dt=st("iterator"),Ut=Array.prototype,zt=function(t){return void 0!==t&&(I.Array===t||Ut[Dt]===t)},qt=st("iterator"),Bt=h.getIteratorMethod=function(t){if(void 0!=t)return t[qt]||t["@@iterator"]||I[Wt(t)]},Jt=e(function(t){var e={},n={},r=t.exports=function(t,r,o,i,u){var c,s,a,f,l=u?function(){return t}:Bt(t),h=p(o,i,r?2:1),v=0;if("function"!=typeof l)throw TypeError(t+" is not iterable!");if(zt(l)){for(c=U(t.length);c>v;v++)if((f=r?h(y(s=t[v])[0],s[1]):h(t[v]))===e||f===n)return f}else for(a=l.call(t);!(s=a.next()).done;)if((f=Lt(a,h,s.value,r))===e||f===n)return f};r.BREAK=e,r.RETURN=n}),Gt=st("species"),Kt=function(t,e){var n,r=y(t).constructor;return void 0===r||void 0==(n=y(r)[Gt])?e:v(n)},Zt=function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)},Ht=l.process,Qt=l.setImmediate,Yt=l.clearImmediate,Vt=l.MessageChannel,Xt=0,$t={},te=function(){var t=+this;if($t.hasOwnProperty(t)){var e=$t[t];delete $t[t],e()}},ee=function(t){te.call(t.data)};Qt&&Yt||(Qt=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return $t[++Xt]=function(){Zt("function"==typeof t?t:Function(t),e)},xt(Xt),Xt},Yt=function(t){delete $t[t]},"process"==W(Ht)?xt=function(t){Ht.nextTick(p(te,t,1))}:Vt?(At=new Vt,Ft=At.port2,At.port1.onmessage=ee,xt=p(Ft.postMessage,Ft,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(xt=function(t){l.postMessage(t+"","*")},l.addEventListener("message",ee,!1)):xt="onreadystatechange"in w("script")?function(t){rt.appendChild(w("script")).onreadystatechange=function(){rt.removeChild(this),te.call(t)}}:function(t){setTimeout(p(te,t,1),0)});var ne={set:Qt,clear:Yt},re=ne.set,oe=l.MutationObserver||l.WebKitMutationObserver,ie=l.process,ue=l.Promise,ce="process"==W(ie),se=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:P(t,r,e[r]);return t},ae=st("species"),fe=st("iterator"),le=!1;try{var he=[7][fe]();he.return=function(){le=!0},Array.from(he,function(){throw 2})}catch(t){}var ve,pe,de,ye=ne.set,me=function(){var t,e,n,r=function(){var r,o;for(ce&&(r=ie.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(ce)n=function(){ie.nextTick(r)};else if(oe){var o=!0,i=document.createTextNode("");new oe(r).observe(i,{characterData:!0}),n=function(){i.data=o=!o}}else if(ue&&ue.resolve){var u=ue.resolve();n=function(){u.then(r)}}else n=function(){re.call(l,r)};return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}(),be=l.TypeError,ge=l.process,_e=l.Promise,ge=l.process,we="process"==Wt(ge),ke=function(){},je=!!function(){try{var t=_e.resolve(1),e=(t.constructor={})[st("species")]=function(t){t(ke,ke)};return(we||"function"==typeof PromiseRejectionEvent)&&t.then(ke)instanceof e}catch(t){}}(),Ee=function(t,e){return t===e||t===_e&&e===de},Oe=function(t){var e;return!(!d(t)||"function"!=typeof(e=t.then))&&e},Me=function(t){return Ee(_e,t)?new Se(t):new pe(t)},Se=pe=function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw be("Bad Promise constructor");e=t,n=r}),this.resolve=v(e),this.reject=v(n)},Pe=function(t){try{t()}catch(t){return{error:t}}},Ce=function(t,e){if(!t._n){t._n=!0;var n=t._c;me(function(){for(var r=t._v,o=1==t._s,i=0;n.length>i;)!function(e){var n,i,u=o?e.ok:e.fail,c=e.resolve,s=e.reject,a=e.domain;try{u?(o||(2==t._h&&Fe(t),t._h=1),!0===u?n=r:(a&&a.enter(),n=u(r),a&&a.exit()),n===e.promise?s(be("Promise-chain cycle")):(i=Oe(n))?i.call(n,c,s):c(n)):s(r)}catch(t){s(t)}}(n[i++]);t._c=[],t._n=!1,e&&!t._h&&xe(t)})}},xe=function(t){ye.call(l,function(){var e,n,r,o=t._v;if(Ae(t)&&(e=Pe(function(){we?ge.emit("unhandledRejection",o,t):(n=l.onunhandledrejection)?n({promise:t,reason:o}):(r=l.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=we||Ae(t)?2:1),t._a=void 0,e)throw e.error})},Ae=function(t){if(1==t._h)return!1;for(var e,n=t._a||t._c,r=0;n.length>r;)if(e=n[r++],e.fail||!Ae(e.promise))return!1;return!0},Fe=function(t){ye.call(l,function(){var e;we?ge.emit("rejectionHandled",t):(e=l.onrejectionhandled)&&e({promise:t,reason:t._v})})},Te=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ce(e,!0))},Ie=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw be("Promise can't be resolved itself");(e=Oe(t))?me(function(){var r={_w:n,_d:!1};try{e.call(t,p(Ie,r,1),p(Te,r,1))}catch(t){Te.call(r,t)}}):(n._v=t,n._s=1,Ce(n,!1))}catch(t){Te.call({_w:n,_d:!1},t)}}};je||(_e=function(t){Nt(this,_e,"Promise","_h"),v(t),ve.call(this);try{t(p(Ie,this,1),p(Te,this,1))}catch(t){Te.call(this,t)}},ve=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},ve.prototype=se(_e.prototype,{then:function(t,e){var n=Me(Kt(this,_e));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=we?ge.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ce(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Se=function(){var t=new ve;this.promise=t,this.resolve=p(Ie,t,1),this.reject=p(Te,t,1)}),x(x.G+x.W+x.F*!je,{Promise:_e}),lt(_e,"Promise"),function(t){var e="function"==typeof h[t]?h[t]:l[t];b&&e&&!e[ae]&&M.f(e,ae,{configurable:!0,get:function(){return this}})}("Promise"),de=h.Promise,x(x.S+x.F*!je,"Promise",{reject:function(t){var e=Me(this);return(0,e.reject)(t),e.promise}}),x(x.S+!0*x.F,"Promise",{resolve:function(t){if(t instanceof _e&&Ee(t.constructor,this))return t;var e=Me(this);return(0,e.resolve)(t),e.promise}}),x(x.S+x.F*!(je&&function(t,e){if(!e&&!le)return!1;var n=!1;try{var r=[7],o=r[fe]();o.next=function(){return{done:n=!0}},r[fe]=function(){return o},t(r)}catch(t){}return n}(function(t){_e.all(t).catch(ke)})),"Promise",{all:function(t){var e=this,n=Me(e),r=n.resolve,o=n.reject,i=Pe(function(){var n=[],i=0,u=1;Jt(t,!1,function(t){var c=i++,s=!1;n.push(void 0),u++,e.resolve(t).then(function(t){s||(s=!0,n[c]=t,--u||r(n))},o)}),--u||r(n)});return i&&o(i.error),n.promise},race:function(t){var e=this,n=Me(e),r=n.reject,o=Pe(function(){Jt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o&&r(o.error),n.promise}});var Re=h.Promise,We=e(function(t){t.exports={default:Re,__esModule:!0}}),Ne=t(We),Le=e(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}),De=t(Le);x(x.S+x.F*!b,"Object",{defineProperty:M.f});var Ue=h.Object,ze=function(t,e,n){return Ue.defineProperty(t,e,n)},qe=e(function(t){t.exports={default:ze,__esModule:!0}}),Be=e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(qe);e.default=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,n.default)(t,o.key,o)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()}),Je=t(Be),Ge=Array.isArray||function(t){return"Array"==W(t)},Ke=st("species"),Ze=function(t){var e;return Ge(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!Ge(e.prototype)||(e=void 0),d(e)&&null===(e=e[Ke])&&(e=void 0)),void 0===e?Array:e},He=function(t,e){return new(Ze(t))(e)},Qe=function(t,e){var n=1==t,r=2==t,o=3==t,i=4==t,u=6==t,c=5==t||u,s=e||He;return function(e,a,f){for(var l,h,v=pt(e),d=N(v),y=p(a,f,3),m=U(d.length),b=0,g=n?s(e,m):r?s(e,0):void 0;m>b;b++)if((c||b in d)&&(l=d[b],h=y(l,b,v),t))if(n)g[b]=h;else if(h)switch(t){case 3:return!0;case 5:return l;case 6:return b;case 2:g.push(l)}else if(i)return!1;return u?-1:o||i?i:g}},Ye=e(function(t){var e=H("meta"),n=M.f,r=0,o=Object.isExtensible||function(){return!0},i=!m(function(){return o(Object.preventExtensions({}))}),u=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},c=function(t,n){if(!d(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!T(t,e)){if(!o(t))return"F";if(!n)return"E";u(t)}return t[e].i},s=function(t,n){if(!T(t,e)){if(!o(t))return!0;if(!n)return!1;u(t)}return t[e].w},a=function(t){return i&&f.NEED&&o(t)&&!T(t,e)&&u(t),t},f=t.exports={KEY:e,NEED:!1,fastKey:c,getWeak:s,onFreeze:a}}),Ve=Object.getOwnPropertySymbols,Xe={f:Ve},$e={}.propertyIsEnumerable,tn={f:$e},en=Object.assign,nn=!en||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=en({},t)[n]||Object.keys(en({},e)).join("")!=r})?function(t,e){for(var n=pt(t),r=arguments.length,o=1,i=Xe.f,u=tn.f;r>o;)for(var c,s=N(arguments[o++]),a=i?et(s).concat(i(s)):et(s),f=a.length,l=0;f>l;)u.call(s,c=a[l++])&&(n[c]=s[c]);return n}:en,rn=Ye.getWeak,on=Qe(5),un=Qe(6),cn=0,sn=function(t){return t._l||(t._l=new an)},an=function(){this.a=[]},fn=function(t,e){return on(t.a,function(t){return t[0]===e})};an.prototype={get:function(t){var e=fn(this,t);if(e)return e[1]},has:function(t){return!!fn(this,t)},set:function(t,e){var n=fn(this,t);n?n[1]=e:this.a.push([t,e])},delete:function(t){var e=un(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}};var ln={getConstructor:function(t,e,n,r){var o=t(function(t,i){Nt(t,o,e,"_i"),t._i=cn++,t._l=void 0,void 0!=i&&Jt(i,n,t[r],t)});return se(o.prototype,{delete:function(t){if(!d(t))return!1;var e=rn(t);return!0===e?sn(this).delete(t):e&&T(e,this._i)&&delete e[this._i]},has:function(t){if(!d(t))return!1;var e=rn(t);return!0===e?sn(this).has(t):e&&T(e,this._i)}}),o},def:function(t,e,n){var r=rn(y(e),!0);return!0===r?sn(t).set(e,n):r[t._i]=n,t},ufstore:sn},hn=M.f,vn=Qe(0),pn=function(t,e,n,r,o,i){var u=l[t],c=u,s=o?"set":"add",a=c&&c.prototype,f={};return b&&"function"==typeof c&&(i||a.forEach&&!m(function(){(new c).entries().next()}))?(c=e(function(e,n){Nt(e,c,t,"_c"),e._c=new u,void 0!=n&&Jt(n,o,e[s],e)}),vn("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in a&&(!i||"clear"!=t)&&P(c.prototype,t,function(n,r){if(Nt(this,c,t),!e&&i&&!d(n))return"get"==t&&void 0;var o=this._c[t](0===n?0:n,r);return e?this:o})}),"size"in a&&hn(c.prototype,"size",{get:function(){return this._c.size}})):(c=r.getConstructor(e,t,o,s),se(c.prototype,n),Ye.NEED=!0),lt(c,t),f[t]=c,x(x.G+x.W+x.F,f),i||r.setStrong(c,t,o),c},dn=(e(function(t){var e,n=Qe(0),r=Ye.getWeak,o=Object.isExtensible,i=ln.ufstore,u={},c=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},s={get:function(t){if(d(t)){var e=r(t);return!0===e?i(this).get(t):e?e[this._i]:void 0}},set:function(t,e){return ln.def(this,t,e)}},a=t.exports=pn("WeakMap",c,s,ln,!0,!0);7!=(new a).set((Object.freeze||Object)(u),7).get(u)&&(e=ln.getConstructor(c),nn(e.prototype,s),Ye.NEED=!0,n(["delete","has","get","set"],function(t){var n=a.prototype,r=n[t];A(n,t,function(n,i){if(d(n)&&!o(n)){this._f||(this._f=new e);var u=this._f[t](n,i);return"set"==t?this:u}return r.call(this,n,i)})}))}),h.WeakMap),yn=e(function(t){t.exports={default:dn,__esModule:!0}}),mn=t(yn);if(void 0===window.postMessage)throw new Error("The Flat Embed JS API is not supported in this browser");!function(t,e){var n=(h.Object||{})[t]||Object[t],r={};r[t]=e(n),x(x.S+x.F*m(function(){n(1)}),"Object",r)}("keys",function(){return function(t){return et(pt(t))}});var bn=h.Object.keys,gn=e(function(t){t.exports={default:bn,__esModule:!0}}),_n=t(gn);x(x.S+x.F,"Object",{assign:nn});var wn=h.Object.assign,kn=e(function(t){t.exports={default:wn,__esModule:!0}}),jn=t(kn),En=function(){function t(e){return De(this,t),this.embed=e,this.promises={},this.eventCallbacks={},this}return Je(t,[{key:"pushCall",value:function(t,e,n){this.promises[t]=this.promises[t]||[],this.promises[t].push({resolve:e,reject:n})}},{key:"subscribeEvent",value:function(t,e){return this.eventCallbacks[t]=this.eventCallbacks[t]||[],this.eventCallbacks[t].push(e),1===this.eventCallbacks[t].length}},{key:"unsubscribeEvent",value:function(t,e){if(!this.eventCallbacks[t])return!1;if(e){var n=this.eventCallbacks[t].indexOf(e);n>=0&&this.eventCallbacks[t].splice(n,1)}else this.eventCallbacks[t]=[];return!e||0===this.eventCallbacks[t].length}},{key:"process",value:function(t){t.method?this.processMethodResponse(t):t.event&&this.processEvent(t)}},{key:"processMethodResponse",value:function(t){var e=this.promises[t.method].shift();e&&(t.error?e.reject(t.error):e.resolve(t.response))}},{key:"processEvent",value:function(t){var e=this;this.eventCallbacks[t.event]&&0!==this.eventCallbacks[t.event].length&&this.eventCallbacks[t.event].forEach(function(n){n.call(e.embed,t.parameters)})}}]),t}(),On=new mn,Mn=new mn;return function(){function Embed(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(De(this,Embed),t=n(t),On.has(t))return On.get(t);"IFRAME"!==t.nodeName&&(t=o(t,r)),this.origin="*",this.element=t,this.embedCallback=new En;var c=new Ne(function(n){var r=function(r){if(t.contentWindow===r.source){"*"===e.origin&&(e.origin=r.origin);var o=u(r.data);if("ready"===o.event||"ping"===o.method)return void n();e.embedCallback.process(o)}};window.addEventListener("message",r,!1),i(e,"ping")});return On.set(this.element,this),Mn.set(this,c),this}return Je(Embed,[{key:"ready",value:function(){return Ne.resolve(Mn.get(this))}},{key:"call",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Ne(function(r,o){return e.ready().then(function(){e.embedCallback.pushCall(t,r,o),i(e,t,n)})})}},{key:"on",value:function(t,e){if("string"!=typeof t)throw new TypeError("An event name (string) is required");if("function"!=typeof e)throw new TypeError("An callback (function) is required");this.embedCallback.subscribeEvent(t,e)&&this.call("addEventListener",t).catch(function(){})}},{key:"off",value:function(t,e){if("string"!=typeof t)throw new TypeError("An event name (string) is required");this.embedCallback.unsubscribeEvent(t,e)&&this.call("removeEventListener",t).catch(function(){})}},{key:"getJson",value:function(){return this.call("getJson")}},{key:"loadFlatScore",value:function(t,e){return this.call("loadFlatScore",{score:t,revision:e})}},{key:"getFlatScoreMetadata",value:function(){return this.call("getFlatScoreMetadata")}},{key:"fullscreen",value:function(t){return this.call("fullscreen",t)}},{key:"play",value:function(){return this.call("play")}},{key:"pause",value:function(){return this.call("pause")}},{key:"stop",value:function(){return this.call("stop")}},{key:"print",value:function(){return this.call("print")}},{key:"getZoom",value:function(){return this.call("getZoom")}},{key:"setZoom",value:function(t){return this.call("setZoom",t)}}]),Embed}()});
